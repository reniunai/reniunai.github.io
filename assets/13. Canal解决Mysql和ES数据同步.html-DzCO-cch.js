import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as n,a as s,e as l,o as e}from"./app-LZShHywJ.js";const t={},h=s("h1",{id:"canal解决mysql和redis数据同步-es",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#canal解决mysql和redis数据同步-es"},[s("span",null,"Canal解决Mysql和Redis数据同步(ES)")])],-1),k=l(`<h3 id="mysql-和-elasticsearch-数据同步方案" tabindex="-1"><a class="header-anchor" href="#mysql-和-elasticsearch-数据同步方案"><span>Mysql 和 ElasticSearch 数据同步方案</span></a></h3><p>根据上面所说，我们就可以通过Canal去自动同步数据库的binlog数据日志文件，然后再把数据同步到ElasticSearch。Canal支持把数据同步到的组件有 ： mysql、Kafka、ElasticSearch、Hbase、RocketMQ等 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303778.png" alt="在这里插入图片描述" loading="lazy"></p><p>和上一章节讲的Redis的同步流程不一样，因为Canal可以直接同步到ElasticSearch，只不过需要安装CanalAdapter来实现，流程如下</p><figure><img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171502584.png" alt="image-20240717150210528" tabindex="0" loading="lazy"><figcaption>image-20240717150210528</figcaption></figure><h3 id="开启mysql-bin-log日志" tabindex="-1"><a class="header-anchor" href="#开启mysql-bin-log日志"><span>开启Mysql bin-log日志</span></a></h3><p>找到Mysql安装目录中的my.ini 配置文件，我以mysql 5.5为例,在 mysqld 下做如下配置</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">[mysqld]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#开启bInlog</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">log-bin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">mysql-bin</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#给mysql服务指定一个唯一的ID</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">server-id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#以数据的方式写binlog日志 ：statement 是记录SQL，row是记录数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">binlog-format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">ROW</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#同步的数据库名</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">binlog-do-db</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">canaldb</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#忽略的表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">binlog-ignore-db</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">mysql</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 启动mysql时不启动grant-tables授权表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#98C379;">skip-grant-tables</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改好之后，重启Mysql服务。注意：我这里指定了需要同步的数据库为canaldb，所以需要创建一个数据库，同时创建了一个employee表作为演示 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303743.png" alt="在这里插入图片描述" loading="lazy"> 然后创建一个用户提供给canal来链接Mysql做数据同步</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">flush privileges;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#创建用户cannal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> USER</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">BY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;canal&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#把所有权限赋予canal，密码也是canal</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ALL PRIVILEGES </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> canaldb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">user</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;canal&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> identified </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;canal&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">//</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">GRANT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, REPLICATION SLAVE, REPLICATION CLIENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TO</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;canal&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> identified </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;canal&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#刷新权限</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">flush privileges;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到这，Mysql部分就搞定了</p><h3 id="安装canal" tabindex="-1"><a class="header-anchor" href="#安装canal"><span>安装Canal</span></a></h3><p>去官网下载 Canal : https://github.com/alibaba/canal/releases ，我使用的是canal.deployer-1.1.5.tar.gz版本<img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303740.png" alt="在这里插入图片描述" loading="lazy"></p><p>下载好之后解压，目录结构如下 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303699.png" alt="在这里插入图片描述" loading="lazy"> 接下来修改instance 配置文件 ： conf/example/instance.properties</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#  按需修改成自己的数据库信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#################################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#我的端口是3307</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">master</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">address</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">192</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">168</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3307</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># username</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,数据库的用户名和密码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#刚才开通的mysql的账户密码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.dbUsername </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> canal</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.dbPassword </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> canal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#################################################</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># mq config 数据同步到MQ中的topic名字</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">mq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.topic</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">example</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># 针对库名或者表名发送动态topic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">mq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.dynamicTopic</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">mytest,.</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">mytest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,mytest\\\\..</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,.</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">\\\\..</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">mq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">partition</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> partition</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">mq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.partitionsNum</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">库名</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">表名</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: 唯一主键，多个表之间用逗号分隔</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">mq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.partitionHash</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">mytest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">person</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:id,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">mytest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">role</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:id</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里注意如下几个东西，其他的不用管</p><ul><li>master.address ：Mysql的地址，我的端口是3307，默认是3306</li><li>dbUsername ：上面开通的Mysql用户</li><li>dbPassword ： 密码</li><li>canal.mq.topic=example ： 数据同步到MQ中的topic名字</li></ul><p>接着修改canal 配置文件 conf/canal.properties</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># 可选项: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">tcp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(默认), kafka, RocketMQ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># 这里使用tcp</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">canal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">serverMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> tcp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">##################################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">######### 		    RocketMQ	     #############</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">##################################################</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rocketmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">producer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.group </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> test</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rocketmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">enable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">trace</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> false</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rocketmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">customized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">trace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">topic</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rocketmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">namespace</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"># RocketMQ的地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rocketmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">namesrv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.addr </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 127</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">9876</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rocketmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">retry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">times</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">when</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.failed </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rocketmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">vip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">channel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> false</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">rocketmq</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里需要注意：canal.serverMode = tcp ： 注意这里是tcp，tcp指的是直接同步到客户端。和上一章节Redis同步还是有点区别，上一章节我们是同步到RocketMQ</p><p>配置好之后，找到 canal 安装目录下 bin目录下的 <code>bin/startup.bat</code> 双击启动，linux上启动：bin/startup.sh <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303800.png" alt="在这里插入图片描述" loading="lazy"></p><h3 id="安装-canal-adapter" tabindex="-1"><a class="header-anchor" href="#安装-canal-adapter"><span>安装 canal-adapter</span></a></h3><p>去官网下载 Canal-adapter : https://github.com/alibaba/canal/releases ，我使用的是canal.adapter-1.1.5.tar.gz 版本 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303408.png" alt="在这里插入图片描述" loading="lazy"></p><p>下载好之后解压，目录如下 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303413.png" alt="在这里插入图片描述" loading="lazy"> 进入到config目录，修改 config/application.yml 文件 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303787.png" alt="在这里插入图片描述" loading="lazy"> 修改内容如下</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">省略...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">canal.conf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  mode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">tcp</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #tcp kafka rocketMQ rabbitMQ</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  ...省略...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  consumerProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # canal tcp consumer</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    canal.tcp.server.host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">127.0.0.1:11111</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #canal的地址</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   ...省略...</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  srcDataSources</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    defaultDS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#同步的数据库，账号，密码，修改为自己的数据库信息</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">      url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">jdbc:mysql://127.0.0.1:3307/canaldb?useUnicode=true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">      username</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">admin</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  canalAdapters</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#adapter配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">example</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # canal instance Name or mq topic name</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    groups</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">g1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">      outerAdapters</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">logger</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">es6</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #es配置，这里使用9200通信 也就是rest模式</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        hosts</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://127.0.0.1:9200&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">        properties</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">          mode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">rest</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # or rest</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#          # security.auth: test:123456 #  only used for rest mode</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">          cluster.name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">elasticsearch</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #集群名字</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面把要修改的内容展示出来了，其他的不用管，具体要修改的如下</p><ul><li>canal.tcp.server.host: 127.0.0.1:11111 ：这个需要指向canal地址</li><li>srcDataSources.defaultDS : 这个跟的是要同步的数据库，包括用户名密码要修改为自己的</li><li>outerAdapters ：代表数据向哪儿输出，我们配置的是ES6，- name ：es6因为我使用的是es6 , hosts使用的是es的9200端口，mode使用rest方式。也可以使用9300，transport模式</li></ul><p>然后进入es6目录，基于mytest_user.yml拷贝重命名一个employee.yml(对应要同步的数据库表),然后删除其他的yml文件</p><p><img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303703.png" alt="在这里插入图片描述" loading="lazy"> employee.yml内容如下</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dataSourceKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">defaultDS</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">example</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">g1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">esMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  _index</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">employee</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #索引库名字</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  _type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">_doc</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #es的type</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  _id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">_id</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #id作为文档ID</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  upsert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  #pk: id # 如果不需要_id, 则需要指定一个属性为主键属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  #sql映射 ，把列名和es进行一一映射    _id 会作为文档ID</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  sql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;select id _id,username from employee&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#  objFields:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#    _labels: array:;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  etlCondition</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;where a.c_time&gt;={}&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  commitBatch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>几个需要修改的参数</p><ul><li>_index: employee #索引库名字</li><li>_type: _doc #es的type</li><li>_id: _id #id作为文档ID</li><li>sql : sql映射 ，根据查询的列名和es的field进行一一映射 ， 支持join连表查询</li></ul><p>到这Canal的配置完成了，启动 canal-adapapter : <code>bin/startup.bat</code> 但是我在启动的时候出现了一个问题 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303918.png" alt="在这里插入图片描述" loading="lazy"> 这个是因为Canal中的druid包和 canal.adapter\\plugin\\client-adapter.es6x-1.1.5-jar-with-dependencies.jar 包中的druid冲突了，我的做法是这样的</p><p>1.下载canal源码：https://github.com/alibaba/canal/tree/canal-1.1.5 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303951.png" alt="在这里插入图片描述" loading="lazy"></p><p>2.使用IDEA打开项目，找到 escore模块，修改pom.xml中druid增加scope如下</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">	&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;com.alibaba&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;druid&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;provided&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.使用mvn install 重新打包 es6x 模块，然后再target中得到 client-adapter.es6x-1.1.5-jar-with-dependencies.jar</p><p>4.把 client-adapter.es6x-1.1.5-jar-with-dependencies.jar 拷贝到canal-adapter安装目录的plugin目录中，覆盖原本的client-adapter.es6x-1.1.5-jar-with-dependencies.jar。</p><p>下面我提供一份打包好的 <a href="https://download.csdn.net/download/u014494148/84348026" target="_blank" rel="noopener noreferrer">client-adapter.es6x-1.1.5-jar-with-dependencies.jar</a> ，您直接下载即可</p><p>5.依次启动canal ，canal-adpater <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303210.png" alt="在这里插入图片描述" loading="lazy"></p><h3 id="es创建索引库和映射" tabindex="-1"><a class="header-anchor" href="#es创建索引库和映射"><span>ES创建索引库和映射</span></a></h3><p>启动ES6，启动kibana , 创建索引库和映射，注意：需要对应 canal-adapter配置的索引库</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">PUT employee</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">#创建映射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">PUT employee/_doc/_mapping</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;_doc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;properties&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">          &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">            &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;long&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">          &quot;username&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> : {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">            &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">            &quot;analyzer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ik_smart&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1234567891011121314151617</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后修改数据库employee表中的数据，然后使用<code>GET employee/_search</code> 观察ES中是否有数据同步 <img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303153.png" alt="在这里插入图片描述" loading="lazy"></p><p>文章到这就结束了，喜欢的话请给个好评，你的鼓励是我最大的动力，谢谢。</p>`,44);function p(d,r){return e(),a("div",null,[h,n(" more "),k])}const y=i(t,[["render",p],["__file","13. Canal解决Mysql和ES数据同步.html.vue"]]),B=JSON.parse('{"path":"/note/redis/13.%20Canal%E8%A7%A3%E5%86%B3Mysql%E5%92%8CES%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5.html","title":"Canal解决Mysql和Redis数据同步(ES)","lang":"zh-CN","frontmatter":{"title":"Canal解决Mysql和Redis数据同步(ES)","cover":"/assets/images/cover1.jpg","icon":"file","order":13,"author":"HotMilk","category":["Redis"],"tag":["Redis","Canal","数据同步","ES"],"head":[["meta",{"property":"og:url","content":"https://reniunai.github.io/note/redis/13.%20Canal%E8%A7%A3%E5%86%B3Mysql%E5%92%8CES%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5.html"}],["meta",{"property":"og:site_name","content":"热牛奶"}],["meta",{"property":"og:title","content":"Canal解决Mysql和Redis数据同步(ES)"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://reniunai.github.io/assets/images/cover1.jpg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-05T09:42:18.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://reniunai.github.io/assets/images/cover1.jpg"}],["meta",{"name":"twitter:image:alt","content":"Canal解决Mysql和Redis数据同步(ES)"}],["meta",{"property":"article:author","content":"HotMilk"}],["meta",{"property":"article:tag","content":"Redis"}],["meta",{"property":"article:tag","content":"Canal"}],["meta",{"property":"article:tag","content":"数据同步"}],["meta",{"property":"article:tag","content":"ES"}],["meta",{"property":"article:modified_time","content":"2024-08-05T09:42:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Canal解决Mysql和Redis数据同步(ES)\\",\\"image\\":[\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303778.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171502584.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303743.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303740.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303699.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303800.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303408.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303413.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303787.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303703.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303918.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303951.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303210.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407171303153.png\\"],\\"dateModified\\":\\"2024-08-05T09:42:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"HotMilk\\"}]}"]]},"headers":[{"level":1,"title":"Canal解决Mysql和Redis数据同步(ES)","slug":"canal解决mysql和redis数据同步-es","link":"#canal解决mysql和redis数据同步-es","children":[{"level":3,"title":"Mysql 和 ElasticSearch 数据同步方案","slug":"mysql-和-elasticsearch-数据同步方案","link":"#mysql-和-elasticsearch-数据同步方案","children":[]},{"level":3,"title":"开启Mysql bin-log日志","slug":"开启mysql-bin-log日志","link":"#开启mysql-bin-log日志","children":[]},{"level":3,"title":"安装Canal","slug":"安装canal","link":"#安装canal","children":[]},{"level":3,"title":"安装 canal-adapter","slug":"安装-canal-adapter","link":"#安装-canal-adapter","children":[]},{"level":3,"title":"ES创建索引库和映射","slug":"es创建索引库和映射","link":"#es创建索引库和映射","children":[]}]}],"git":{"createdTime":1722847687000,"updatedTime":1722850938000,"contributors":[{"name":"reniunai","email":"2843768@qq.com","commits":2}]},"readingTime":{"minutes":6.23,"words":1869},"filePathRelative":"note/redis/13. Canal解决Mysql和ES数据同步.md","localizedDate":"2024年8月5日","excerpt":"\\n"}');export{y as comp,B as data};
