import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,d as a,a as i,e as s,o as n}from"./app-Bv3jHGDE.js";const o={},c=i("p",null,"数据同步到Elasticsearch，同步写，异步写，中间件实现同步。",-1),l=s('<h1 id="同步双写" tabindex="-1"><a class="header-anchor" href="#同步双写"><span>同步双写</span></a></h1><p>在写入MySQL时同时写入ES，这是最简单的方式。</p><figure><img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161711219.png" alt="image-20240716171141128" tabindex="0" loading="lazy"><figcaption>image-20240716171141128</figcaption></figure><p>优点：系统结构简单，不用引入新的组件，实时性高。</p><p>缺点：耦合度高，MYSQL写入失败或ES写入失败都需要考虑回滚，接口性能下降。</p><h1 id="异步写" tabindex="-1"><a class="header-anchor" href="#异步写"><span>异步写</span></a></h1><p>基于MQ来实现。</p><figure><img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161711670.png" alt="image-20240716171151636" tabindex="0" loading="lazy"><figcaption>image-20240716171151636</figcaption></figure><p>优点：解耦，基于MQ消费确认机制保证数据。</p><p>缺点：基于MQ，有一定延时。</p><h1 id="中间件-数据迁移工具" tabindex="-1"><a class="header-anchor" href="#中间件-数据迁移工具"><span>中间件-数据迁移工具</span></a></h1><p>基于binlog日志，MySQL通过binlog订阅实现主从同步，canal也是这个原理，将client组件伪装成从库，来实现数据订阅。</p><figure><img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161712118.png" alt="image-20240716171207081" tabindex="0" loading="lazy"><figcaption>image-20240716171207081</figcaption></figure><p>Canal 原理就是伪装成 MySQL 的从节点，从而订阅 master 节点的 Binlog 日志，主要流程为：</p><ol><li>Canal 服务端向 MySQL 的 master 节点传输 dump 协议；</li><li>MySQL 的 master 节点接收到 dump 请求后推送 Binlog 日志给 Canal 服务端，解析 Binlog 对象（原始为 byte 流）转成 Json 格式；</li><li>Canal 客户端通过 TCP 协议或 MQ 形式监听 Canal 服务端，同步数据到 ES。</li></ol><p>下面是 Cannel 执行的核心流程，其中 Binlog Parser 主要负责 Binlog 的提取、解析和推送，EventSink 负责数据的过滤 、路由和加工，仅作了解即可。</p><figure><img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161725540.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><h1 id="定时任务扫描" tabindex="-1"><a class="header-anchor" href="#定时任务扫描"><span>定时任务扫描</span></a></h1><p>如果对实时性要求不高的情况下，可以考虑用定时器来处理：</p><ol><li>数据库的相关表中增加一个字段为 timestamp 的字段，任何 CURD 操作都会导致该字段的时间发生变化；</li><li>原来程序中的 CURD 操作不做任何变化；</li><li>增加一个定时器程序，让该程序按一定的时间周期扫描指定的表，把该时间段内发生变化的数据提取出来；</li><li>逐条写入到 ES 中。</li></ol><figure><img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161712686.png" alt="image-20240716171234652" tabindex="0" loading="lazy"><figcaption>image-20240716171234652</figcaption></figure><p>优点：</p><ul><li>不改变原来代码，没有侵入性、没有硬编码；</li><li>没有业务强耦合，不改变原来程序的性能；</li><li>Worker 代码编写简单不需要考虑增删改查。</li></ul><p>缺点：</p><ul><li>时效性较差，由于是采用定时器根据固定频率查询表来同步数据，尽管将同步周期设置到秒级，也还是会存在一定时间的延迟；</li><li>对数据库有一定的轮询压力，一种改进方法是将轮询放到压力不大的从库上。</li></ul><blockquote><p>经典方案：借助 Logstash 实现数据同步，其底层实现原理就是根据配置定期使用 SQL 查询新增的数据写入 ES 中，实现数据的增量同步。</p></blockquote><h1 id="mysql主从复制原理" tabindex="-1"><a class="header-anchor" href="#mysql主从复制原理"><span>MySQL主从复制原理</span></a></h1><figure><img src="https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161737205.png" alt="image-20240716173734159" tabindex="0" loading="lazy"><figcaption>image-20240716173734159</figcaption></figure><h1 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h1><p><a href="https://www.cnblogs.com/88223100/p/Four-data-synchronization-schemes-to-Elasticsearch.html" target="_blank" rel="noopener noreferrer">4种数据同步到Elasticsearch方案 - 古道轻风 - 博客园 (cnblogs.com)</a></p>',30);function r(p,h){return n(),t("div",null,[c,a(" more "),l])}const d=e(o,[["render",r],["__file","安装Go，配置VScode.html.vue"]]),u=JSON.parse('{"path":"/note/linux/deepin/%E5%AE%89%E8%A3%85Go%EF%BC%8C%E9%85%8D%E7%BD%AEVScode.html","title":"数据同步到Elasticsearch","lang":"zh-CN","frontmatter":{"title":"数据同步到Elasticsearch","cover":"/assets/images/cover1.jpg","icon":"file","order":3,"author":"HotMilk","date":"2024-07-15T00:00:00.000Z","category":["Elasticsearch"],"tag":["elasticsearch","数据同步"],"description":"数据同步到Elasticsearch，同步写，异步写，中间件实现同步。","head":[["meta",{"property":"og:url","content":"https://reniunai.github.io/note/linux/deepin/%E5%AE%89%E8%A3%85Go%EF%BC%8C%E9%85%8D%E7%BD%AEVScode.html"}],["meta",{"property":"og:site_name","content":"热牛奶"}],["meta",{"property":"og:title","content":"数据同步到Elasticsearch"}],["meta",{"property":"og:description","content":"数据同步到Elasticsearch，同步写，异步写，中间件实现同步。"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://reniunai.github.io/assets/images/cover1.jpg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-05T08:48:07.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://reniunai.github.io/assets/images/cover1.jpg"}],["meta",{"name":"twitter:image:alt","content":"数据同步到Elasticsearch"}],["meta",{"property":"article:author","content":"HotMilk"}],["meta",{"property":"article:tag","content":"elasticsearch"}],["meta",{"property":"article:tag","content":"数据同步"}],["meta",{"property":"article:published_time","content":"2024-07-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-05T08:48:07.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"数据同步到Elasticsearch\\",\\"image\\":[\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161711219.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161711670.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161712118.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161725540.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161712686.png\\",\\"https://hotmilk-pic.oss-cn-shenzhen.aliyuncs.com/assets/202407161737205.png\\"],\\"datePublished\\":\\"2024-07-15T00:00:00.000Z\\",\\"dateModified\\":\\"2024-08-05T08:48:07.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"HotMilk\\"}]}"]]},"headers":[],"git":{"createdTime":1722847687000,"updatedTime":1722847687000,"contributors":[{"name":"reniunai","email":"2843768@qq.com","commits":1}]},"readingTime":{"minutes":2.96,"words":887},"filePathRelative":"note/linux/deepin/安装Go，配置VScode.md","localizedDate":"2024年7月15日","excerpt":"<p>数据同步到Elasticsearch，同步写，异步写，中间件实现同步。</p>\\n","autoDesc":true}');export{d as comp,u as data};
