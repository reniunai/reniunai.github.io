import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,d as a,a as l,e,o as p}from"./app-zamys2Ga.js";const o={},r=l("p",null,"go-简单使用elasticsearch",-1),t=e(`<p>go-es客户端：github.com/elastic/go-elasticsearch/v8</p><p>执行以下命令安装v8版本的 go 客户端。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#88C0D0;">go</span><span style="color:#A3BE8C;"> get</span><span style="color:#A3BE8C;"> github.com/elastic/go-elasticsearch/v8@latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>导入依赖。</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">github.com/elastic/go-elasticsearch/v8</span><span style="color:#ECEFF4;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>可以根据实际需求导入不同的客户端版本，也支持在一个项目中导入不同的客户端版本。</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span>
<span class="line"><span style="color:#D8DEE9;">  elasticsearch7</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">github.com/elastic/go-elasticsearch/v7</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9;">  elasticsearch8</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">github.com/elastic/go-elasticsearch/v8</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ...</span></span>
<span class="line"><span style="color:#D8DEE9;">es7</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> elasticsearch7</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">NewDefaultClient</span><span style="color:#ECEFF4;">()</span></span>
<span class="line"><span style="color:#D8DEE9;">es8</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> elasticsearch8</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">NewDefaultClient</span><span style="color:#ECEFF4;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="连接-es" tabindex="-1"><a class="header-anchor" href="#连接-es"><span>连接 ES</span></a></h2><p>指定要连接 ES 的相关配置，并创建客户端连接。</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// ES 配置</span></span>
<span class="line"><span style="color:#D8DEE9;">cfg</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9FF;"> elasticsearch</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Config</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">        Addresses</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> []</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">http://localhost:9200</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">        },</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// 创建客户端连接</span></span>
<span class="line"><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> elasticsearch</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">NewTypedClient</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">cfg</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        fmt</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Printf</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">elasticsearch.NewTypedClient failed, err:</span><span style="color:#EBCB8B;">%v\\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建索引：</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">// createIndex 创建索引</span></span>
<span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> createIndex</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">client</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">elasticsearch</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">TypedClient</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> client</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Indices</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Create</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">my-review-1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">).</span><span style="color:#88C0D0;">Do</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">context</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Background</span><span style="color:#ECEFF4;">())</span></span>
<span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">        fmt</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Printf</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">create index failed, err:</span><span style="color:#EBCB8B;">%v\\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">        return</span></span>
<span class="line"><span style="color:#ECEFF4;">    }</span></span>
<span class="line"><span style="color:#D8DEE9;">    fmt</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Printf</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">index:</span><span style="color:#EBCB8B;">%#v\\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Index</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="gin中创建es" tabindex="-1"><a class="header-anchor" href="#gin中创建es"><span>gin中创建es</span></a></h1><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#D8DEE9FF;"> es</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span>
<span class="line"><span style="color:#ECEFF4;">	&quot;</span><span style="color:#A3BE8C;">bluebell/setting</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">	&quot;</span><span style="color:#A3BE8C;">fmt</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ECEFF4;">	&quot;</span><span style="color:#A3BE8C;">github.com/elastic/go-elasticsearch/v8</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">var</span><span style="color:#D8DEE9;"> Esdb</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">elasticsearch</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">TypedClient</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// Init 初始化ES连接</span></span>
<span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> Init</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">cfg</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">setting</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ESConfig</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">err</span><span style="color:#81A1C1;"> error</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">	// 创建客户端连接</span></span>
<span class="line"><span style="color:#D8DEE9;">	Esdb</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> elasticsearch</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">NewTypedClient</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">elasticsearch</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Config</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9;">		Addresses</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> cfg</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Adders</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">	})</span></span>
<span class="line"><span style="color:#81A1C1;">	if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">		fmt</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Printf</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">elasticsearch.NewTypedClient failed, err:</span><span style="color:#EBCB8B;">%v\\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">		return</span></span>
<span class="line"><span style="color:#ECEFF4;">	}</span></span>
<span class="line"><span style="color:#D8DEE9;">	fmt</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Printf</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">init es succss, Esdb:</span><span style="color:#EBCB8B;">%v\\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Esdb</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">	return</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// ES连接没有关闭方法</span></span>
<span class="line"><span style="color:#616E88;">// func Close() {</span></span>
<span class="line"><span style="color:#616E88;">// 	_ = esdb.()</span></span>
<span class="line"><span style="color:#616E88;">// }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="数据同步方案" tabindex="-1"><a class="header-anchor" href="#数据同步方案"><span>数据同步方案</span></a></h1><p>有同步，有异步，有中间件。这里讨论的都是增量同步，如果要全量同步，可以使用logstash-input-jdbc<code>，</code>go-mysql-elasticsearch<code>，</code>elasticsearch-jdbc等插件，实现对mysql的数据导入到es中。</p><h1 id="同步" tabindex="-1"><a class="header-anchor" href="#同步"><span>同步</span></a></h1><p>最为简单，在发表帖子时，直接写入es当中。</p><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="background-color:#2e3440ff;color:#d8dee9ff;"><pre class="shiki nord vp-code"><code><span class="line"><span style="color:#616E88;">//同步写es</span></span>
<span class="line"><span style="color:#616E88;">// CreatePostHandler 创建帖子的处理函数</span></span>
<span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> CreatePostHandler</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">gin</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#616E88;">	// 1. 获取参数及参数的校验</span></span>
<span class="line"><span style="color:#616E88;">	//c.ShouldBindJSON()  // validator --&gt; binding tag</span></span>
<span class="line"><span style="color:#D8DEE9;">	p</span><span style="color:#81A1C1;"> :=</span><span style="color:#88C0D0;"> new</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">models</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Post</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">	if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> c</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ShouldBindJSON</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">p</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">		zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">L</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">Debug</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">c.ShouldBindJSON(p) error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Any</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">err</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#D8DEE9;">		zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">L</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">create post with invalid param</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#88C0D0;">		ResponseError</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> CodeInvalidParam</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">		return</span></span>
<span class="line"><span style="color:#ECEFF4;">	}</span></span>
<span class="line"><span style="color:#616E88;">	// 从 c 取到当前发请求的用户的ID</span></span>
<span class="line"><span style="color:#D8DEE9;">	userID</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#88C0D0;"> getCurrentUserID</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">	if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#88C0D0;">		ResponseError</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> CodeNeedLogin</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">		return</span></span>
<span class="line"><span style="color:#ECEFF4;">	}</span></span>
<span class="line"><span style="color:#D8DEE9;">	p</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">AuthorID</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> userID</span></span>
<span class="line"><span style="color:#616E88;">	// 2. 创建帖子</span></span>
<span class="line"><span style="color:#81A1C1;">	if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> logic</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">CreatePost</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">p</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">		zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">L</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">logic.CreatePost(p) failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#88C0D0;">		ResponseError</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> CodeServerBusy</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">		return</span></span>
<span class="line"><span style="color:#ECEFF4;">	}</span></span>
<span class="line"><span style="color:#616E88;">    //es直接同步</span></span>
<span class="line"><span style="color:#616E88;">    	// 2. 根据id取出帖子数据（查数据库）</span></span>
<span class="line"><span style="color:#D8DEE9;">	data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> logic</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">GetPostById</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">p</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">	if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">		zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">L</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">logic.GetPostById(pid) failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#88C0D0;">		ResponseError</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> CodeServerBusy</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">		return</span></span>
<span class="line"><span style="color:#ECEFF4;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">	// 3.获取该用户的粉丝集合，从mysql获取，或者从redis中获取都可以，然后推送粉丝</span></span>
<span class="line"><span style="color:#D8DEE9;">	data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> logic</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SelectFans</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">p</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">AuthorID</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">	if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">		zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">L</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">logic.SelectFans(p); failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#88C0D0;">		ResponseError</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> CodeServerBusy</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">		return</span></span>
<span class="line"><span style="color:#ECEFF4;">	}</span></span>
<span class="line"><span style="color:#616E88;">	// 4. 根据粉丝集合，进行推送</span></span>
<span class="line"><span style="color:#81A1C1;">	if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> logic</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SendFeed</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">data</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> p</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span>
<span class="line"><span style="color:#D8DEE9;">		zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">L</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">logic.SendFeed() failed</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> zap</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#88C0D0;">		ResponseError</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> CodeServerBusy</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">		return</span></span>
<span class="line"><span style="color:#ECEFF4;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">	// 5. 返回响应</span></span>
<span class="line"><span style="color:#88C0D0;">	ResponseSuccess</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">c</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="异步" tabindex="-1"><a class="header-anchor" href="#异步"><span>异步</span></a></h1>`,20);function c(E,i){return p(),n("div",null,[r,a(" more "),t])}const d=s(o,[["render",c],["__file","gin使用elasticsearch实现帖子全文检索.html.vue"]]),C=JSON.parse('{"path":"/note/go/gin%E4%BD%BF%E7%94%A8elasticsearch%E5%AE%9E%E7%8E%B0%E5%B8%96%E5%AD%90%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2.html","title":"go-简单使用elasticsearch","lang":"zh-CN","frontmatter":{"title":"go-简单使用elasticsearch","cover":"/assets/images/cover1.jpg","icon":"file","order":3,"author":"HotMilk","date":"2024-07-15T00:00:00.000Z","category":["Go"],"tag":["elasticsearch"],"description":"go-简单使用elasticsearch","head":[["meta",{"property":"og:url","content":"https://reniunai.github.io/note/go/gin%E4%BD%BF%E7%94%A8elasticsearch%E5%AE%9E%E7%8E%B0%E5%B8%96%E5%AD%90%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2.html"}],["meta",{"property":"og:site_name","content":"热牛奶"}],["meta",{"property":"og:title","content":"go-简单使用elasticsearch"}],["meta",{"property":"og:description","content":"go-简单使用elasticsearch"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://reniunai.github.io/assets/images/cover1.jpg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-05T08:48:07.000Z"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:src","content":"https://reniunai.github.io/assets/images/cover1.jpg"}],["meta",{"name":"twitter:image:alt","content":"go-简单使用elasticsearch"}],["meta",{"property":"article:author","content":"HotMilk"}],["meta",{"property":"article:tag","content":"elasticsearch"}],["meta",{"property":"article:published_time","content":"2024-07-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-05T08:48:07.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"go-简单使用elasticsearch\\",\\"image\\":[\\"https://reniunai.github.io/assets/images/cover1.jpg\\"],\\"datePublished\\":\\"2024-07-15T00:00:00.000Z\\",\\"dateModified\\":\\"2024-08-05T08:48:07.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"HotMilk\\"}]}"]]},"headers":[{"level":2,"title":"连接 ES","slug":"连接-es","link":"#连接-es","children":[]}],"git":{"createdTime":1722847687000,"updatedTime":1722847687000,"contributors":[{"name":"reniunai","email":"2843768@qq.com","commits":1}]},"readingTime":{"minutes":2.48,"words":745},"filePathRelative":"note/go/gin使用elasticsearch实现帖子全文检索.md","localizedDate":"2024年7月15日","excerpt":"<p>go-简单使用elasticsearch</p>\\n","autoDesc":true}');export{d as comp,C as data};
